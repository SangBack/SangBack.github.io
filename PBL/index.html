<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>학습 진행 · Unity WebGL</title>

  <!-- Fonts -->
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/static/pretendard.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/spoqa/spoqa-han-sans/css/SpoqaHanSansNeo.css">

  <style>
    :root{
      --gap:20px;
      --card-pad:20px;
      --panel-h:252px; /* 미션/결과 높이 동기화 */
      --right-gutter:20px; /* 우측 하늘색 여백 폭 */
      --bg-grad-start:#D8E5FD;
      --bg-grad-end:#86AFF9;
      --blue:#256EF4;
      --gray-1:#F6F6F6;
      --gray-2:#E3E3E3;
      --text:#000;
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:'Spoqa Han Sans Neo', Pretendard, system-ui, -apple-system, sans-serif;
      /* 페이지 전체 배경: 이 그라데이션만 사용 (하단 이상색 띠 방지) */
      background:linear-gradient(180deg, var(--bg-grad-start) 0%, var(--bg-grad-end) 100%);
      background-attachment:fixed;
    }

    /* 우측 20px 하늘색 세로 여백 */
    .right-sky {
      position:fixed; inset:auto 0 0 auto;
      top:0; right:0; width:var(--right-gutter); height:100vh;
      background:linear-gradient(180deg, var(--bg-grad-start) 0%, var(--bg-grad-end) 100%);
      pointer-events:none; z-index:10;
    }

    /* 상단 바 (고정 아님 / 투명 배경) */
    .topbar{
      position:relative;
      display:flex; align-items:center; gap:2px;
      padding:2px 4px;
      padding-right:calc(24px + var(--right-gutter));
      background:transparent; /* 상단 그라데이션 그대로 보이게 */
      box-shadow:none;
      backdrop-filter:none;
    }
    .topbar .logo{
      display:flex; align-items:center; gap:12px; min-width:140px;
    }
    .topbar .logo img{ width:97px; height:79px; object-fit:contain; display:block; margin-left:110px; margin-top: 10px;}
    .topbar .nav{
      display:flex; gap:24px; align-items:center; flex-wrap:wrap;
      margin-left:130px; margin-top: 30px;/* ← nav를 살짝 오른쪽으로 밀기 */
    }
    .topbar .nav .chip{
      padding:12px 32px; border-radius:100px;
      font:500 18px 'Spoqa Han Sans Neo';
      color:#454545; background:transparent; white-space:nowrap;
    }
    .topbar .nav .chip.active{
      background:linear-gradient(180deg,#fff 0%, #D8E5FD 100%);
      box-shadow:0 4px 8px rgba(0,0,0,.08); color:var(--blue); font-weight:700;
    }
    .topbar .spacer{flex:1}
    .topbar .right{
      display:flex; align-items:center; gap:16px;
    }
    .topbar .right .icon img{ width:50px; height:50px; object-fit:contain; display:block; margin-top: 30px;}
    .topbar .profile{ display:flex; align-items:center; gap:10px; }
    .topbar .profile .avatar{
      width:48px; height:48px; margin-top: 30px; background:#86AFF9; border-radius:9999px;
      display:flex; align-items:center; justify-content:center; overflow:hidden;
    }
    .topbar .profile .avatar img{ width:32px; height:32px; display:block; }
    .topbar .profile .meta{ display:flex; flex-direction:column; gap:3px; margin-top: 30px;}
    .pill{ padding:0 6px; background:#F6F6F6; border-radius:100px; display:inline-block; font:500 12px 'Spoqa Han Sans Neo'; color:#33363D; }

    /* 페이지 레이아웃 (여기엔 배경 없음: 하단 띠 방지) */
    .page{
      display:grid;
      grid-template-columns: 297px minmax(0,1fr);
      gap:var(--gap);
      padding:var(--gap);
      padding-right:calc(var(--gap) + var(--right-gutter)); /* 우측 여백만큼 확보 */
      align-items:start;
      background:transparent; /* ★ 배경 투명 유지 */
    }

    /* 좌측 패널 공통 카드 */
    .sidebar{
      display:flex; flex-direction:column; gap:20px;
      min-height:0;
    }
    .card{
      background:#fff; border-radius:8px; box-shadow:0 4px 8px rgba(0,0,0,.08);
      padding:20px;
      outline:1px solid var(--gray-2);
    }

    .info-row{ display:flex; align-items:center; justify-content:space-between; gap:6px; }
    .info-row .label{ display:flex; align-items:center; gap:6px; color:var(--blue); font:700 16px 'Spoqa Han Sans Neo'; }
    .info-row .label .dot{
      width:24px; height:24px; border-radius:50%; background:var(--blue);
      display:flex; align-items:center; justify-content:center; overflow:hidden;
    }
    .info-row .label .dot img{ width:18px; height:18px; object-fit:contain; display:block; }
    .info-row .value{ width:99px; font:500 16px 'Spoqa Han Sans Neo'; color:#000; text-align:right; }

    /* 진행률 (요청: 카드 뒤 흰 배경 제거) */
    .progress-container{
      padding:0;
      background:transparent;    /* ★ 흰 배경 제거 */
      box-shadow:none;           /* ★ 그림자 제거 */
      outline:none;              /* ★ 외곽선 제거 */
    }
    .progress-wrap{ padding:0 10px; display:flex; background:transparent; }
    .tab{
      min-width:71px; padding:2px 32px; border-top-left-radius:6px; border-top-right-radius:6px;
      display:flex; align-items:center; justify-content:center; white-space:nowrap;
      font:700 14px 'Spoqa Han Sans Neo';
    }
    .tab.primary{ background:#86AFF9; color:#fff; }
    .tab.sub{ background:#D8E5FD; color:#646464; font-weight:500; }

    .progress-card{
      background:linear-gradient(180deg,#86AFF9 0%, #256EF4 100%);
      border-radius:8px; padding:20px; display:flex; flex-direction:column; gap:12px;
      color:#fff;
    }
    .progress-row{ display:flex; justify-content:space-between; align-items:center; }
    .progress-title{ display:flex; align-items:center; gap:8px; }
    /* 흰 라운드 배경 제거: 아이콘만 노출 */
    .progress-title .fix-icon{ width:16px; height:16px; display:block; }

    .bar{ width:217px; height:22px; background:#256EF4; border-radius:100px; position:relative; overflow:hidden; }
    .bar .fill{ width:51px; height:100%; background:linear-gradient(90deg,#fff 0%, #B1CEFB 100%); border-top-left-radius:100px; border-bottom-left-radius:100px; }

    /* 트리뷰 */
    .tree{ height:641px; overflow:auto; }
    .tree details{ width:100%; }
    .tree summary{
      list-style:none; cursor:pointer; display:flex; justify-content:space-between; align-items:center; padding:6px;
    }
    .js-parent-header{ display:flex; align-items:center; gap:8px; }
    .js-parent-header .state-dot{
      width:24px; height:24px; border-radius:9999px; display:flex; align-items:center; justify-content:center;
      background:var(--blue);
    }
    .js-parent-header .state-dot.border{ background:transparent; border:2px solid var(--blue); }
    .js-parent-header .state-dot.gray{ background:transparent; border:2px solid #A1A1A1; }
    .state-dot img{ width:14px; height:14px; display:block; object-fit:contain; }
    .parent-title{ font:500 16px 'Spoqa Han Sans Neo'; color:#000; }
    .badge{ width:48px; padding:2px 0; border-radius:50px; display:flex; align-items:center; justify-content:center; font:400 12px Pretendard; }
    .badge.pass{ background:#D0FFCA; color:#13A600; }
    .badge.pause{ background:#FFF1D4; color:#BC6503; }
    .badge.fail{ background:#FFD4D4; color:#BC0303; }

    .parent-active{ background:#D8E5FD; border-radius:6px; }
    .parent-active .parent-title{ color:var(--blue); }

    .js-child{ padding:6px 20px; font:500 14px 'Spoqa Han Sans Neo'; color:#000; cursor:pointer; }
    .js-child.child-active{ color:var(--blue); }

    /* 메인 */
    .main{ min-width:0; background:transparent; }
    .main-card{
      background:#fff; border-radius:8px; box-shadow:0 4px 8px rgba(0,0,0,.08); padding:20px; display:flex; flex-direction:column; gap:20px;
    }
    .split{
      display:flex; gap:20px; align-items:flex-start; flex-wrap:wrap;
    }
    .left-col{ flex:0 1 980px; min-width:520px; display:flex; flex-direction:column; gap:10px; }
    .right-col{ flex:1 1 480px; min-width:420px; display:flex; flex-direction:column; gap:16px; }

    .title-bar{ height:50px; display:flex; justify-content:space-between; align-items:center; }
    .title-bar .wrap{
      flex:1 1 0; padding:8px 10px; background:#D8E5FD; border-radius:8px; display:flex; justify-content:space-between; align-items:center;
    }
    .title-bar .left{ display:flex; align-items:center; gap:10px; }
    .label-chip{ padding:4px 10px; background:#fff; border-radius:6px; display:flex; align-items:center; justify-content:center; color:var(--blue); font:700 20px 'Spoqa Han Sans Neo'; line-height:28px; }
    .title-txt{ color:#000; font:700 20px 'Spoqa Han Sans Neo'; line-height:28px; }
    .title-bar .right{ min-width:106px; display:flex; align-items:center; gap:10px; }
    .title-bar .right .difficulty{ padding:2px 10px; background:#F6F6F6; border-radius:50px; display:flex; align-items:center; }
    .title-bar .right .difficulty span{ color:#33363D; font:400 12px Pretendard; line-height:16.8px; }
    .icon32{ width:32px; height:32px; display:flex; align-items:center; justify-content:center; }
    .icon32 img{ width:32px; height:32px; object-fit:contain; display:block; }

    .webgl{
      height:552px; border-radius:8px; border:1px solid var(--gray-2); overflow:hidden; position:relative; background:#000;
    }
    #unity-canvas{ width:100%; height:100%; display:block; background:#000; }
    .hud-badge{ position:absolute; z-index:3; pointer-events:none; }
    .hud-left{ left:8px; top:8px; }
    .hud-right{ right:8px; top:8px; }
    .hud-card{ padding:10px 12px; background:rgba(0,0,0,.35); border-radius:8px; display:flex; align-items:center; gap:12px; color:#fff; }
    .round-36{ width:36px; height:36px; background:#D9D9D9; border-radius:9999px; display:flex; align-items:center; justify-content:center; overflow:hidden; }
    .round-36 img{ width:22px; height:22px; object-fit:contain; display:block; }
    .team img{ width:50px; height:50px; display:block; object-fit:contain; }

    .editor-head{ display:flex; align-items:center; justify-content:space-between; }
    .btn-outline{
      height:36px; padding:0 12px; background:#D8E5FD; border-radius:4px; outline:1px #0B50D0 solid; display:flex; align-items:center;
      color:#0B50D0; font:500 14px 'Spoqa Han Sans Neo';
    }
    .editor-area{
      height:552px; display:flex; flex-direction:column; gap:16px;
    }
    .codebox{ flex:1 1 auto; padding:20px; background:#232323; border-radius:8px; outline:1px var(--gray-2) solid; min-height:0; }
    #monaco{ width:100%; height:100%; }
    .btn-row{ display:flex; gap:16px; }
    .btn{ flex:1 1 0; height:48px; border-radius:4px; display:flex; align-items:center; justify-content:center; cursor:pointer; }
    .btn.save{ background:#D8E5FD; outline:1px #0B50D0 solid; color:#0B50D0; font:500 16px 'Spoqa Han Sans Neo'; }
    .btn.run{ background:#256EF4; color:#fff; font:500 16px 'Spoqa Han Sans Neo'; }

    /* 하단 미션/결과 */
    .bottom{ display:flex; gap:20px; align-items:flex-start; flex-wrap:wrap; }
    .mission-col{ flex:0 1 980px; min-width:520px; display:flex; flex-direction:column; gap:10px; }
    .result-col{ flex:1 1 480px; min-width:420px; display:flex; flex-direction:column; gap:0px; }

    .mission-head{ display:flex; justify-content:space-between; align-items:center; }
    .mission-title{ font:700 20px 'Spoqa Han Sans Neo'; }
    .mission-tabs{
      padding:4px 6px; background:#D8E5FD; border-radius:6px; display:flex; align-items:center;
    }
    .mission-tabs .slot{
      width:71px; display:flex; align-items:center; justify-content:center; color:#646464; font:500 14px 'Spoqa Han Sans Neo';
    }
    .mission-tabs .slot.active{
      background:#fff; color:var(--blue); border-radius:100px; font-weight:700;
    }
    .nav-circles{ display:flex; gap:6px; }
    .nav-circles .circle{
      width:26px; height:26px; background:#A1A1A1; border-radius:9999px; display:flex; align-items:center; justify-content:center;
    }
    .nav-circles .circle img{ width:16px; height:16px; object-fit:contain; display:block; }

    .mission-box, .result-box{
      height:var(--panel-h);
      padding:20px; background:#F6F6F6; border-radius:8px; outline:1px var(--gray-2) solid;
      display:flex; flex-direction:column; gap:8px; overflow:auto;
    }

    /* 반응형 보정 */
    @media (max-width:1200px){
      .left-col, .mission-col{ flex-basis:100%; min-width:0; }
      .right-col, .result-col{ flex:1 1 100%; min-width:0; }
    }
    @media (max-width:640px){
      .topbar{ padding:10px 14px; padding-right:calc(14px + var(--right-gutter)); }
      .topbar .nav{ gap:12px; }
      .editor-area{ height:420px; }
      .webgl{ height:360px; }
      :root{ --panel-h:200px; }
    }

    /* 결과 헤더: 제목-버튼 한 줄 정렬 */
.result-head{
  display:flex;
  align-items:center;
  justify-content:space-between;
  margin-bottom: 5px; /* 살짝 띄우기 */
  gap:12px;
  flex-wrap:nowrap;      /* 줄바꿈 방지 */
}

/* 결과 > '로그 삭제' 버튼 스타일 */
.btn-gray{
  height:36px;
  padding:0 12px;
  background:#787878;
  border-radius:4px;
  display:flex;
  align-items:center;
  justify-content:center;
  color:#fff;
  font:500 14px 'Spoqa Han Sans Neo';
  white-space:nowrap;    /* 버튼 텍스트 줄바꿈 방지 */
}
  </style>
</head>
<body>
  <!-- 우측 전체 세로 20px 하늘색 여백 -->
  <div class="right-sky"></div>

  <!-- 상단 네비게이션 (logo.png 왼쪽, 메뉴 오른쪽) : 고정 아님 / 투명배경 -->
  <header class="topbar">
    <div class="logo">
      <img src="logo.png" alt="Logo">
    </div>
    <nav class="nav">
      <div class="chip">홈</div>
      <div class="chip active">학습 진행</div>
      <div class="chip">학습 평가</div>
      <div class="chip">코드 리뷰</div>
      <div class="chip">학습 지원</div>
      <div class="chip">포트폴리오</div>
      <div class="chip">마이 페이지</div>
    </nav>
    <div class="spacer"></div>
    <div class="right">
      <div class="icon"><img src="Alarm.png" alt="알림"></div>
      <div class="profile">
        <div class="avatar"><img src="person.png" alt="프로필"></div>
        <div class="meta">
          <div style="font:700 14px 'Spoqa Han Sans Neo'">감귤</div>
          <span class="pill">Lv.3</span>
        </div>
      </div>
    </div>
  </header>

  <!-- 메인 페이지 그리드 -->
  <div class="page">
    <!-- 좌측 패널 -->
    <aside class="sidebar">
      <!-- 상단 정보 카드 -->
      <div class="card" style="display:flex; flex-direction:column; gap:16px;">
        <div class="info-row">
          <div class="label"><span class="dot"><img src="book.png" alt=""></span>분야</div>
          <div class="value">AI 기반 자동화</div>
        </div>
        <div class="info-row">
          <div class="label"><span class="dot"><img src="portal.png" alt=""></span>구분</div>
          <div class="value">Phyton</div>
        </div>
        <div class="info-row" style="align-items:flex-start;">
          <div class="label"><span class="dot"><img src="Calander.png" alt=""></span>학습기간</div>
          <div class="value">2025.09.01~<br/>2025.12.31</div>
        </div>
      </div>

      <!-- 진행률 (배경/그림자/외곽선 제거됨) -->
      <div class="card progress-container">
        <div class="progress-wrap">
          <div class="tab primary">전체</div>
          <div class="tab sub">과정</div>
        </div>
        <div class="progress-card">
          <div class="progress-row">
            <div class="progress-title">
              <img class="fix-icon" src="Fix.png" alt="">
              <span style="font:700 16px 'Spoqa Han Sans Neo'">학습 진행률</span>
            </div>
            <div style="width:99px; text-align:right; color:#FFDB4B; font:700 18px Pretendard;">22%</div>
          </div>
          <div class="bar"><div class="fill"></div></div>
        </div>
      </div>

      <!-- 트리 뷰 -->
      <div class="card tree">
        <!-- 과정 1 -->
        <details open>
          <summary>
            <div class="js-parent-header">
              <div class="state-dot"><img src="Check.png" alt=""></div>
              <div class="parent-title">과정 1</div>
              <div class="badge pass">PASS</div>
            </div>
            <img class="js-arrow" src="arrow_up.png" alt="접기" style="width:20px; height:20px; display:block;">
          </summary>
          <div style="margin-top:4px; background:#F6F6F6; border-radius:6px; padding:6px 0;">
            <div class="js-child">과정-자식1</div>
            <div class="js-child">과정-자식2</div>
            <div class="js-child">과정-자식3</div>
          </div>
        </details>

        <!-- 과정 2 -->
        <details>
          <summary>
            <div class="js-parent-header">
              <div class="state-dot"><img src="Check.png" alt=""></div>
              <div class="parent-title">과정 2</div>
              <div class="badge pause">PAUSE</div>
            </div>
            <img class="js-arrow" src="arrow_down.png" alt="펼치기" style="width:20px; height:20px; display:block;">
          </summary>
          <div style="margin-top:4px; background:#F6F6F6; border-radius:6px; padding:6px 0;">
            <div class="js-child">과정-자식1</div>
            <div class="js-child">과정-자식2</div>
            <div class="js-child">과정-자식3</div>
          </div>
        </details>

        <!-- 과정 3 -->
        <details>
          <summary>
            <div class="js-parent-header">
              <div class="state-dot"><img src="Check.png" alt=""></div>
              <div class="parent-title">과정 3</div>
              <div class="badge fail">FAIL</div>
            </div>
            <img class="js-arrow" src="arrow_down.png" alt="펼치기" style="width:20px; height:20px; display:block;">
          </summary>
          <div style="margin-top:4px; background:#F6F6F6; border-radius:6px; padding:6px 0;">
            <div class="js-child">과정-자식1</div>
            <div class="js-child">과정-자식2</div>
            <div class="js-child">과정-자식3</div>
          </div>
        </details>

        <!-- 과정 4 -->
        <details>
          <summary>
            <div class="js-parent-header">
              <div class="state-dot border"></div>
              <div class="parent-title">과정 4</div>
            </div>
            <img class="js-arrow" src="arrow_down.png" alt="펼치기" style="width:20px; height:20px; display:block;">
          </summary>
          <div style="background:#F6F6F6; border-radius:6px; display:flex; flex-direction:column; gap:4px; padding:6px 0;">
            <div class="js-child">과정-자식1</div>
            <div class="js-child">과정-자식2</div>
            <div class="js-child">과정-자식3</div>
          </div>
        </details>

        <!-- 과정 5~9 (동일 패턴) -->
        <details>
          <summary>
            <div class="js-parent-header">
              <div class="state-dot gray"></div>
              <div class="parent-title" style="color:#A1A1A1;">과정 5</div>
            </div>
            <img class="js-arrow" src="arrow_down.png" alt="펼치기" style="width:20px; height:20px; display:block;">
          </summary>
          <div style="margin-top:4px; background:#F6F6F6; border-radius:6px; padding:6px 0;">
            <div class="js-child">과정-자식1</div>
            <div class="js-child">과정-자식2</div>
            <div class="js-child">과정-자식3</div>
          </div>
        </details>

        <details>
          <summary>
            <div class="js-parent-header">
              <div class="state-dot gray"></div>
              <div class="parent-title" style="color:#A1A1A1;">과정 6</div>
            </div>
            <img class="js-arrow" src="arrow_down.png" alt="펼치기" style="width:20px; height:20px; display:block;">
          </summary>
          <div style="margin-top:4px; background:#F6F6F6; border-radius:6px; padding:6px 0;">
            <div class="js-child">과정-자식1</div>
            <div class="js-child">과정-자식2</div>
            <div class="js-child">과정-자식3</div>
          </div>
        </details>

        <details>
          <summary>
            <div class="js-parent-header">
              <div class="state-dot gray"></div>
              <div class="parent-title" style="color:#A1A1A1;">과정 7</div>
            </div>
            <img class="js-arrow" src="arrow_down.png" alt="펼치기" style="width:20px; height:20px; display:block;">
          </summary>
          <div style="margin-top:4px; background:#F6F6F6; border-radius:6px; padding:6px 0%;">
            <div class="js-child">과정-자식1</div>
            <div class="js-child">과정-자식2</div>
            <div class="js-child">과정-자식3</div>
          </div>
        </details>

        <details>
          <summary>
            <div class="js-parent-header">
              <div class="state-dot gray"></div>
              <div class="parent-title" style="color:#A1A1A1;">과정 8</div>
            </div>
            <img class="js-arrow" src="arrow_down.png" alt="펼치기" style="width:20px; height:20px; display:block;">
          </summary>
          <div style="margin-top:4px; background:#F6F6F6; border-radius:6px; padding:6px 0;">
            <div class="js-child">과정-자식1</div>
            <div class="js-child">과정-자식2</div>
            <div class="js-child">과정-자식3</div>
          </div>
        </details>

        <details>
          <summary>
            <div class="js-parent-header">
              <div class="state-dot gray"></div>
              <div class="parent-title" style="color:#A1A1A1;">과정 9</div>
            </div>
            <img class="js-arrow" src="arrow_down.png" alt="펼치기" style="width:20px; height:20px; display:block;">
          </summary>
          <div style="margin-top:4px; background:#F6F6F6; border-radius:6px; padding:6px 0;">
            <div class="js-child">과정-자식1</div>
            <div class="js-child">과정-자식2</div>
            <div class="js-child">과정-자식3</div>
          </div>
        </details>
      </div>
    </aside>

    <!-- 메인 -->
    <main class="main">
      <section class="main-card">
        <!-- 상단: 좌 WebGL / 우 코드 -->
        <div class="split">
          <!-- 좌 -->
          <div class="left-col">
            <div class="title-bar">
              <div class="wrap">
                <div class="left">
                  <div class="label-chip">과정 4-1</div>
                  <div class="title-txt">아크 원자로 복원</div>
                </div>
                <div class="right">
                  <div class="difficulty"><span>난이도 중</span></div>
                  <div class="icon32"><img src="error.png" alt="에러"></div>
                </div>
              </div>
            </div>

            <!-- WebGL + HUD -->
            <div class="webgl">
              <canvas id="unity-canvas" tabindex="-1"></canvas>

              <div class="hud-badge hud-left">
                <div class="hud-card">
                  <div class="round-36"><img src="mandarine.png" alt=""></div>
                  <div style="display:flex; flex-direction:column; gap:4px;">
                    <div style="color:#fff; font:700 14px 'Spoqa Han Sans Neo'">감귤</div>
                    <div class="pill" style="align-self:flex-start; background:#C0C0C0; color:#33363D; font-weight:600;">Lv.3</div>
                  </div>
                </div>
              </div>

              <div class="hud-badge hud-right">
                <div class="hud-card team" style="gap:8px;">
                  <img src="team.png" alt="">
                  <div style="color:#fff; font:600 14px 'Spoqa Han Sans Neo'">Team 1</div>
                </div>
              </div>
            </div>
          </div>

          <!-- 우 -->
          <div class="right-col">
            <div class="editor-head">
              <div style="padding:8px 6px; font:700 20px 'Spoqa Han Sans Neo'">코드 에디터</div>
              <div class="btn-outline">코드 리뷰 요청</div>
            </div>

            <div class="editor-area">
              <div class="codebox">
                <div id="monaco"></div>
                <textarea id="codeArea" style="display:none;"></textarea>
              </div>
              <div class="btn-row">
                <div id="btnSave" class="btn save">코드 임시 저장</div>
                <div id="btnRun" class="btn run">코드 실행</div>
              </div>
            </div>
          </div>
        </div>

        <!-- 하단: 미션 / 결과 (둘 다 같은 높이) -->
        <div class="bottom">
          <!-- 미션 -->
          <div class="mission-col">
            <div class="mission-head">
              <div style="display:flex; align-items:center; gap:32px;">
                <div class="mission-title">미션</div>
                <div class="mission-tabs">
                  <div class="slot active">수행 과제</div>
                  <div class="slot">세부 내용</div>
                  <div class="slot">제약 조건</div>
                  <div class="slot">개발 환경</div>
                  <div class="slot">획득 역량</div>
                </div>
              </div>
              <div class="nav-circles">
                <div class="circle"><img src="arrow_left.png" alt="이전"></div>
                <div class="circle"><img src="arrow_right.png" alt="다음"></div>
              </div>
            </div>

            <div class="mission-box">
              <div id="missionDesc" style="color:#000; font:400 16px 'Spoqa Han Sans Neo'">[ 미션 설명 자리 ]</div>
            </div>
          </div>

          <!-- 결과 -->
          <div class="result-col">
            <div class="result-head">
              <div style="font:700 20px 'Spoqa Han Sans Neo'">결과</div>
              <div class="btn-gray">로그 삭제</div>
            </div>
            <div class="result-box">
              <div id="logArea" style="color:#646464; font:400 16px 'Spoqa Han Sans Neo'">[ 실행 로그 자리 ]</div>
            </div>
          </div>
        </div>
      </section>
    </main>
  </div>

  <!-- ▼ Unity WebGL 로더 -->
  <script src="Build/PBL.loader.js"></script>

  <!-- ▼ 브릿지 -->
  <script src="webbridge.js"></script>

  <!-- ▼ mission.js -->
  <script src="mission.js"></script>

  <!-- ▼ Monaco Editor (CDN) -->
  <script>
    window.require = { paths: { 'vs': 'https://cdn.jsdelivr.net/npm/monaco-editor@0.45.0/min/vs' } };
  </script>
  <script src="https://cdn.jsdelivr.net/npm/monaco-editor@0.45.0/min/vs/loader.min.js"></script>

  <!-- ▼ Unity WebGL 초기화 -->
  <script>
    (function(){
      const canvas = document.getElementById('unity-canvas');
      if (!canvas) return;

      const isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
      const config = {
        dataUrl: "Build/PBL.data.unityweb",
        frameworkUrl: "Build/PBL.framework.js.unityweb",
        codeUrl: "Build/PBL.wasm.unityweb",
        streamingAssetsUrl: "StreamingAssets",
        companyName: "DefaultCompany",
        productName: "PBL_Demo",
        productVersion: "0.1.0",
        devicePixelRatio: isMobile ? 1 : (window.devicePixelRatio || 1),
        matchWebGLToCanvasSize: true
      };

      if (typeof createUnityInstance !== 'function') {
        console.warn('Unity loader가 아직 로드되지 않았습니다.');
        return;
      }

      createUnityInstance(canvas, config).then((inst)=>{
        window.unityInstance = inst;
        window.WebBridge?.ready?.();
      }).catch(err=>{
        console.error(err);
        const wrap = canvas.parentElement;
        if (wrap){
          wrap.insertAdjacentHTML('beforeend',
            '<div style="position:absolute;inset:0;display:flex;align-items:center;justify-content:center;color:#fff;background:rgba(0,0,0,.6);font:600 14px Pretendard;">Unity 로딩 실패</div>'
          );
        }
      });
    })();
  </script>

  <!-- ▼ Monaco Mount + 실행/로그 파이프라인 -->
  <script>
    const API_BASE = 'http://192.168.0.177:5000';

    let editor; // Monaco 인스턴스
    const $log     = document.getElementById('logArea');
    const $btnSave = document.getElementById('btnSave');
    const $btnRun  = document.getElementById('btnRun');

    function escapeHTML(s=''){
      return s.replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;','\'':'&#39;'}[c]));
    }
    function setLogHTML(html){ $log.innerHTML = html; }
    function setLogText(text){ $log.textContent = text; }

    function showRunning(text){ setLogText(text || '실행 중...'); }
    function showSyntaxError(log){
      setLogHTML(
        '[SYNTAX ERROR]\n\n' +
        '<pre style="margin:0;white-space:pre-wrap">'+escapeHTML(log || '')+'</pre>'
      );
    }
    function showRunResult(stdout, stderr, exitcode){
      let html = '';
      html += 'EXIT CODE: ' + (typeof exitcode==='number'? exitcode : String(exitcode)) + '\n\n';
      html += '[STDOUT]\n' + (stdout && stdout.trim().length
        ? '<pre style="margin:0 0 12px;white-space:pre-wrap">'+escapeHTML(stdout)+'</pre>\n'
        : '(no output)\n\n');
      if (stderr && stderr.trim().length){
        html += '[STDERR]\n<pre style="margin:0;white-space:pre-wrap;color:#b00020">'+escapeHTML(stderr)+'</pre>';
      }
      setLogHTML(html);
    }
    function showError(e){
      setLogText('요청 중 오류가 발생했습니다: ' + (e && e.message ? e.message : e));
    }

    async function checkSyntax(code){
      try{
        const r = await fetch(API_BASE + '/syntax', {
          method:'POST', headers:{'Content-Type':'application/json'},
          body: JSON.stringify({ code, filename:'<monaco>' })
        });
        if (!r.ok) return { ok:true, skipped:true };
        const json = await r.json();
        return json;
      }catch(e){
        return { ok:true, skipped:true };
      }
    }

    async function runCode(){
      try{
        const code = editor ? editor.getValue() : (document.getElementById('codeArea').value || '');
        showRunning('문법 검사 중...');

        const syn = await checkSyntax(code);
        if (syn && syn.ok === false){
          window.WebBridge?.emit('code.run.error', {
            phase: 'syntax',
            message: (syn.error && syn.error.msg) || 'Syntax Error'
          });
          return showSyntaxError(syn.log || (syn.error && syn.error.log) || 'Syntax Error');
        }

        showRunning('실행 중...');
        window.WebBridge?.emit('code.run.start', {});

        const r = await fetch(API_BASE + '/run', {
          method:'POST', headers:{'Content-Type':'application/json'},
          body: JSON.stringify({ code, stdin: '' })
        });
        const json = await r.json();
        if (json && json.ok){
          showRunResult(json.stdout||'', json.stderr||'', json.exitcode);
          window.WebBridge?.emit('code.run.complete', {
            exitcode: json.exitcode,
            hasError: !!(json.stderr && json.stderr.trim().length),
            stdoutPreview: (json.stdout || '').slice(0,160),
            stdout: json.stdout || ''
          });
        }else{
          const msg = (json && json.error) ? json.error : '실행 실패';
          showError(msg);
          window.WebBridge?.emit('code.run.error', { phase: 'run', message: String(msg) });
        }
      }catch(e){
        showError(e);
        window.WebBridge?.emit('code.run.error', { phase: 'exception', message: String(e && e.message ? e.message : e) });
      }
    }

    function mountMonaco(){
      require(['vs/editor/editor.main'], function () {
        const mountEl = document.getElementById('monaco');
        editor = monaco.editor.create(mountEl, {
          value: localStorage.getItem('codeDraft') || '# 여기에 코드를 작성하세요.\n',
          language: 'python',
          theme: 'vs-dark',
          automaticLayout: true,
          minimap: { enabled: false },
          fontSize: 14,
          lineNumbers: 'on',
          padding: { top: 12, bottom: 12 }
        });
      });
    }
    if (window.require && window.require.config) { mountMonaco(); }

    $btnSave.addEventListener('click', ()=>{
      const code = editor ? editor.getValue() : (document.getElementById('codeArea').value || '');
      localStorage.setItem('codeDraft', code);
      setLogText('임시 저장되었습니다.');
    });

    $btnRun.addEventListener('click', ()=>{
      const code = editor ? editor.getValue() : (document.getElementById('codeArea').value || '');
      window.WebBridge?.emit('code.run.request', { hasInput: /\binput\s*\(/.test(code) });
      runCode();
    });
  </script>

  <!-- ▼ 트리뷰 토글/클릭 이벤트 -->
  <script>
    document.addEventListener('DOMContentLoaded', function(){
      if (window.Missions && typeof Missions.init === 'function'){
        Missions.init();
      }

      const tree = document.querySelector('.tree');
      if (tree){
        const updateArrow = (d) => {
          const arrow = d.querySelector('.js-arrow');
          if (!arrow) return;
          if (d.open) {
            arrow.src = 'arrow_up.png';
            arrow.alt = '접기';
            d.querySelector('summary')?.classList.add('parent-active');
          } else {
            arrow.src = 'arrow_down.png';
            arrow.alt = '펼치기';
            d.querySelector('summary')?.classList.remove('parent-active');
          }
        };

        tree.querySelectorAll('details').forEach((d, courseIdx)=>{
          updateArrow(d);
          d.addEventListener('toggle', ()=> updateArrow(d));

          d.querySelectorAll('.js-child').forEach((child, stepIdx)=>{
            child.addEventListener('click', ()=>{
              tree.querySelectorAll('.js-child').forEach(el=> el.classList.remove('child-active'));
              child.classList.add('child-active');

              tree.querySelectorAll('summary').forEach(s=> s.classList.remove('parent-active'));
              d.querySelector('summary')?.classList.add('parent-active');

              window.WebBridge?.emit('tree.step', {
                course: courseIdx + 1,
                step: stepIdx + 1
              });
            });
          });
        });
      }
    });
  </script>
  <script>
  // ▼ 미션 탭 좌/우 화살표 네비게이션
  document.addEventListener('DOMContentLoaded', function () {
    const tabsWrap = document.querySelector('.mission-tabs');
    if (!tabsWrap) return;

    const slots = Array.from(tabsWrap.querySelectorAll('.slot'));
    // 화살표 버튼 (아이콘 alt 텍스트로 찾음)
    const btnPrev = document.querySelector('.nav-circles .circle img[alt="이전"]')?.parentElement;
    const btnNext = document.querySelector('.nav-circles .circle img[alt="다음"]')?.parentElement;

    // 현재 활성 인덱스 찾기 (없으면 0번 활성화)
    let cur = slots.findIndex(el => el.classList.contains('active'));
    if (cur < 0) {
      cur = 0;
      slots[0]?.classList.add('active');
    }

    function setActive(i) {
      if (!slots.length) return;
      // 순환 이동(끝에서 오른쪽 누르면 처음으로, 처음에서 왼쪽 누르면 끝으로)
      cur = (i + slots.length) % slots.length;

      slots.forEach(el => el.classList.remove('active'));
      const active = slots[cur];
      active.classList.add('active');

      // (선택) Unity/브릿지로 이벤트 보내고 싶으면 유지
      window.WebBridge?.emit?.('mission.tab.change', {
        index: cur,
        label: active.textContent.trim()
      });
    }

    // 클릭으로도 직접 선택 가능
    slots.forEach((el, i) => el.addEventListener('click', () => setActive(i)));

    // 화살표 이동
    btnNext?.addEventListener('click', () => setActive(cur + 1));
    btnPrev?.addEventListener('click', () => setActive(cur - 1));
  });
</script>
</body>
</html>
